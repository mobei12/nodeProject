doctype html
html
    head
        title 测试页
        link(rel='stylesheet' href='/stylesheets/bootstrap.min.css')
        link(rel='stylesheet', href='/stylesheets/style.css')
        script(src='/javascripts/jquery-2.1.4.min.js')
        script(src='/javascripts/common.js')
        script(type='text/javascript').
            $(function () {
                select()
            })
            function select() {//查询全部
                var url = "/demo/select";//路由地址
                $.get(url, function (result) {
                    var dataList = result.dataList;
                    if (result.success) {
                        var html = '';
                        for (var item in dataList) {
                            html += '<tr>';
                            html += '<td>' + dataList[item].name + '</td>';
                            html += '<td>' + dataList[item].phone + '</td>';
                            html += '<td>' + dataList[item].email + '</td>';
                            html += '<td class="row">';
                            html += '<button class= "btn btn-default btn-sm" onclick ="edit(\'' + dataList[item]._id + '\')">修改</button>';
                            html += '<button class= "btn btn-default btn-sm" onclick ="deleteById(\'' + dataList[item]._id + '\')">删除</button>';
                            html += '</td>';
                            html += '/<tr>';
                        }
                        $("#datacontent").html(html);
                    }

                });

            }
            function edit(id) {//查询要修改的
                var url = "/demo/selectById";//路由地址
                var data = {};
                data.id = id
                $.post(url, data, function (result) {
                    if (result.success) {
                        $("#name").val(result.data.name);
                        $("#phone").val(result.data.phone);
                        $("#email").val(result.data.email);
                        $("#name").attr("dataId", result.data._id);
                        $('.edit_content').removeClass('hidden');
                    }
                })
            }
            function save(el) {//保存修改
                var id = $("#name").attr("dataId");
                var name = $("#name").val();
                var phone = $("#phone").val();
                var email = $("#email").val();
                if (id) {
                    var url = "/demo/editById";//路由地址
                    var data = {};
                    data.id = id;
                    data.name = name;
                    data.phone = phone;
                    data.email = email;
                    $.post(url, data, function (result) {
                        if (result.success) {
                            alert("修改成功！")
                            location.reload();
                        }
                    })
                } else {
                    alert("请选择要修改的内容！");
                }

            }
            function confirm(el) {
                var name = $(".add_content .form-group .name").val();
                var phone = $(".add_content .form-group .phone").val();
                var email = $(".add_content .form-group .email").val();
                if (name && phone && email) {
                    var url = "/demo/addData";//路由地址
                    var data = {};
                    data.name = name;
                    data.phone = phone;
                    data.email = email;
                    $.post(url, data, function (result) {
                        if (result.success) {
                            if (result.success) {
                                location.reload();
                            }
                        }
                    })
                } else {
                    alert("请填完整内容框！");
                }
            }
            function deleteById(id) {
                var url = "/demo/deleteById";//路由地址
                var data = {};
                data.id = id
                $.post(url, data, function (result) {
                    if (result.success) {
                        alert("删除成功！")
                        location.reload();
                    }
                })
            }
body.main-content
    block content
        div.table_content
            h3.text-center 用户表
            div.edit_button.text-right
                button.btn.btn-default.btn-sm(onclick='location.reload()') 刷新
                button.btn.btn-default.btn-sm(onclick='$(\'.add_content\').removeClass(\'hidden\')') 新增
            table.table.table-hover.table-bordered
                thead
                    tr
                        th 姓名
                        th 电话
                        th 邮箱
                        th 操作
                tbody#datacontent
        div.edit_content.hidden
            h3.text-center 修改
            form#submit.form-inline.form_content
                div.form-group
                    label 姓名
                    input#name.form-control(type='text' name='name' placeholder='请输入名字' )
                div.form-group
                    label 手机号
                    input#phone.form-control(type='text' name='phone' placeholder='请输入手机号' )
                div.form-group
                    label 邮箱
                    input#email.form-control(type='text' name='email' placeholder='请输入邮箱' )
            button.btn.btn-default(type='button' onclick='save(this)') 保存
            button.btn.btn-default(type='button' onclick='$(\'.edit_content\').addClass(\'hidden\')') 取消

        div.add_content.hidden
            h3.text-center 新增
            form.form-inline.form_content
                div.form-group.center-block
                    label 姓名
                    input.name.form-control(type='text' name='name' placeholder='请输入名字')
                div.form-group.center-block
                    label 手机号
                    input.phone.form-control(type='text' name='phone' placeholder='请输入手机号')
                div.form-group.center-block
                    label 邮箱
                    input.email.form-control(type='text' name='email' placeholder='请输入邮箱')
            button.btn.btn-default(type='button' onclick='confirm(this)') 提交
            button.btn.btn-default(type='button' onclick='$(\'.add_content\').addClass(\'hidden\')') 取消




